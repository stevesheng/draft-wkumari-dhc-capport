{"name":"Draft-wkumari-dhc-capport","tagline":"An ID discussing using DHCP to tell clients that they are behind a captive portal.","body":"```\r\n\r\n\r\n\r\nNetwork Working Group                                          W. Kumari\r\nInternet-Draft                                                    Google\r\nIntended status: Informational                            O. Gudmundsson\r\nExpires: March 12, 2015                                    Shinkuro Inc.\r\n                                                             P. Ebersman\r\n                                                                 Comcast\r\n                                                                S. Sheng\r\n                                                                   ICANN\r\n                                                       September 8, 2014\r\n\r\n\r\n               Captive-Portal identification in DHCP / RA\r\n                      draft-wkumari-dhc-capport-05\r\n\r\nAbstract\r\n\r\n   In many environments (such as hotels, coffee shops and other\r\n   establishments that offer Internet service to customers), it is\r\n   common to start new connections in a captive portal mode, i.e. highly\r\n   restrict what the customer can do until the customer has accepted\r\n   terms of service, provided payment information and / or\r\n   authenticated.\r\n\r\n   This document describes a DHCP option (and an RA extension) to inform\r\n   clients that they are behind some sort of captive portal device, and\r\n   that they will need to authenticate to get Internet Access.\r\n\r\nStatus of This Memo\r\n\r\n   This Internet-Draft is submitted in full conformance with the\r\n   provisions of BCP 78 and BCP 79.\r\n\r\n   Internet-Drafts are working documents of the Internet Engineering\r\n   Task Force (IETF).  Note that other groups may also distribute\r\n   working documents as Internet-Drafts.  The list of current Internet-\r\n   Drafts is at http://datatracker.ietf.org/drafts/current/.\r\n\r\n   Internet-Drafts are draft documents valid for a maximum of six months\r\n   and may be updated, replaced, or obsoleted by other documents at any\r\n   time.  It is inappropriate to use Internet-Drafts as reference\r\n   material or to cite them other than as \"work in progress.\"\r\n\r\n   This Internet-Draft will expire on March 12, 2015.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nKumari, et al.           Expires March 12, 2015                 [Page 1]\r\n\f\r\nInternet-Draft             DHCP Captive-Portal            September 2014\r\n\r\n\r\nCopyright Notice\r\n\r\n   Copyright (c) 2014 IETF Trust and the persons identified as the\r\n   document authors.  All rights reserved.\r\n\r\n   This document is subject to BCP 78 and the IETF Trust's Legal\r\n   Provisions Relating to IETF Documents\r\n   (http://trustee.ietf.org/license-info) in effect on the date of\r\n   publication of this document.  Please review these documents\r\n   carefully, as they describe your rights and restrictions with respect\r\n   to this document.  Code Components extracted from this document must\r\n   include Simplified BSD License text as described in Section 4.e of\r\n   the Trust Legal Provisions and are provided without warranty as\r\n   described in the Simplified BSD License.\r\n\r\nTable of Contents\r\n\r\n   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2\r\n     1.1.  Requirements notation . . . . . . . . . . . . . . . . . .   3\r\n   2.  Background  . . . . . . . . . . . . . . . . . . . . . . . . .   3\r\n     2.1.  DNS Redirection . . . . . . . . . . . . . . . . . . . . .   4\r\n     2.2.  HTTP Redirection  . . . . . . . . . . . . . . . . . . . .   4\r\n     2.3.  IP Hijacking  . . . . . . . . . . . . . . . . . . . . . .   4\r\n   3.  The Captive-Portal DHCP Option  . . . . . . . . . . . . . . .   5\r\n   4.  The Captive-Portal RA Option  . . . . . . . . . . . . . . . .   5\r\n   5.  Use of the Captive-Portal Option  . . . . . . . . . . . . . .   6\r\n   6.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   7\r\n   7.  Security Considerations . . . . . . . . . . . . . . . . . . .   8\r\n   8.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   8\r\n   9.  Normative References  . . . . . . . . . . . . . . . . . . . .   8\r\n   Appendix A.  Changes / Author Notes.  . . . . . . . . . . . . . .   9\r\n   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  10\r\n\r\n1.  Introduction\r\n\r\n   In many environments, users need to connect to a captive portal\r\n   device and agree to an acceptable use policy and / or provide billing\r\n   information before they can access the Internet.\r\n\r\n   In order to present the user with the captive portal web page, many\r\n   devices perform DNS and / or HTTP and / or IP hijacks.  As well as\r\n   being kludgy hacks, these techniques looks very similar to attacks\r\n   that DNSSEC and TLS protect against, which makes the user experience\r\n   sub-optimal.\r\n\r\n   This document describes a DHCP option (Captive-Portal) and an IPv6\r\n   Router Advertisement (RA) extension that informs clients that they\r\n   are behind a captive portal device, and how to contact it.\r\n\r\n\r\n\r\nKumari, et al.           Expires March 12, 2015                 [Page 2]\r\n\f\r\nInternet-Draft             DHCP Captive-Portal            September 2014\r\n\r\n\r\n   This document neither condones nor condemns captive portals; instead,\r\n   it recognises that they are here to stay, and attempts to improve the\r\n   user experience.\r\n\r\n   The technique described in this document mainly improve the user\r\n   experience when first connecting to a network behind a captive\r\n   portal.  It may also help if the captive portal access times out\r\n   after connecting, but this is less reliable.\r\n\r\n1.1.  Requirements notation\r\n\r\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"SHALL NOT\",\r\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and \"OPTIONAL\" in this\r\n   document are to be interpreted as described in [RFC2119].\r\n\r\n2.  Background\r\n\r\n   Many Internet Service Providers (ISPs) that offer public Internet\r\n   access require the user to accept an Acceptable Use Policy (AUP) and\r\n   / or provides billing information (such as their last name and room\r\n   number in a hotel, credit card information, etc.) through a web\r\n   interface before the user can access the Internet.\r\n\r\n   In order to meet this requirement, some ISPs implement a captive\r\n   portal (CP) - a system that intercepts user requests and redirects\r\n   them to an interstitial login page.\r\n\r\n   Captive portals intercept and redirects user requests in a number of\r\n   ways, including:\r\n\r\n   o  DNS Redirection\r\n\r\n   o  IP Redirection\r\n\r\n   o  HTTP Redirection\r\n\r\n   o  Restricted scope addresses\r\n\r\n   o  Traffic blocking (until the user is authenticated)\r\n\r\n   In order to ensure that the user is unable to access the Internet\r\n   until they have satisfied the requirements, captive portals usually\r\n   implement IP based filters, or place the user into a restricted VLAN\r\n   (or restricted IP range) until after they have been authorized /\r\n   satisfied.\r\n\r\n   These techniques are very similar to attacks that protocols (such as\r\n   VPNs, DNSSEC, TLS) are designed to protect against.  The interaction\r\n\r\n\r\n\r\nKumari, et al.           Expires March 12, 2015                 [Page 3]\r\n\f\r\nInternet-Draft             DHCP Captive-Portal            September 2014\r\n\r\n\r\n   of the these protections and the interception leads to poor user\r\n   experiences, such as long timeouts, inability to reach the captive\r\n   portal web page, etc.  The interception may also leak user\r\n   information (for example, if the captive portal intercepts and logs\r\n   an HTTP Cookie, or URL of the form http://fred:password@example.com).\r\n   The user is often unaware of what is causing the issue (their browser\r\n   appears to hang, saying something like \"Downloading Proxy Script\", or\r\n   simply \"The Internet doesn't work\"), and they become frustrated.\r\n   This may results in them not purchasing the Internet access provided\r\n   by the captive portal.\r\n\r\n2.1.  DNS Redirection\r\n\r\n   The CP either intercepts all DNS traffic or advertises itself (for\r\n   example using DHCP) as the recursive server for the network.  Until\r\n   the user has authenticated to the captive portal, the CP responds to\r\n   all DNS requests listing the address of its web portal.  Once the\r\n   user has authenticated the CP returns the \"correct\" addresses.\r\n\r\n   This technique has many shortcomings.  It fails if the client is\r\n   performing DNSSEC validation, is running their own resolver, is using\r\n   a VPN, or already has the DNS information cached.\r\n\r\n2.2.  HTTP Redirection\r\n\r\n   In this implementation, the CP acts like a transparent HTTP proxy;\r\n   but when it sees an HTTP request from an unauthenticated client, it\r\n   intercepts the request and responds with an HTTP status code 302 to\r\n   redirect the client to the Captive Portal Login.\r\n\r\n   This technique has a number of issues, including:\r\n\r\n   o  It fails if the user is only using HTTPS.\r\n\r\n   o  It exposes various private user information, such as HTTP Cookies,\r\n      etc.\r\n\r\n   o  It doesn't work if the client has a VPN and / or proxies their web\r\n      traffic to an external web proxy.\r\n\r\n2.3.  IP Hijacking\r\n\r\n   In this scenario, the captive portal intercepts connections to any IP\r\n   address.  It spoofs the destination IP address and \"pretends\" to be\r\n   whatever the user tried to access.\r\n\r\n\r\n\r\n\r\n\r\n\r\nKumari, et al.           Expires March 12, 2015                 [Page 4]\r\n\f\r\nInternet-Draft             DHCP Captive-Portal            September 2014\r\n\r\n\r\n   This technique has issues similar to the HTTP solution, but may also\r\n   break other protocols, and may expose more of the user's private\r\n   information.\r\n\r\n3.  The Captive-Portal DHCP Option\r\n\r\n   The Captive Portal DHCP Option (TBA1) informs the DHCP client that it\r\n   is behind a captive portal and provides the URI to access an\r\n   authentication page.  This is primarily intended to improve the user\r\n   experience; for the foreseeable future (until such time that most\r\n   systems implement this technique) captive portals will still need to\r\n   implement the interception techniques to serve legacy clients.\r\n\r\n   The format of the DHCP Captive-Portal DHCP option is shown below.\r\n\r\n     Code    Len          Data\r\n     +------+------+------+------+------+--   --+-----+\r\n     | code |  len |  URI                  ...        |\r\n     +------+------+------+------+------+--   --+-----+\r\n\r\n   o  Code: The Captive-Portal DHCP Option (TBA1 for DHCPv4, TBA2 for\r\n      DHCPv6)\r\n\r\n   o  Len: The length, in octets of the URI.\r\n\r\n   o  URI: The URI of the authentication page that the user should\r\n      connect to.\r\n\r\n   The URI MUST NOT contain a DNS name, in order to not require the CP\r\n   to access DNS queries from an unauthenticated user.  Rather, if IPv4\r\n   is supported in the network, one option's URI MUST contain an IPv4\r\n   address literal, and if IPv6 is supported in the network, one\r\n   option's URI MUST contain an IPv6 address literal.  Note that this\r\n   implies that a dual stack network would include two such options in\r\n   its DHCP reply or RA.\r\n\r\n   [ED NOTE: Using an address literal is less than ideal, but better\r\n   than the alternatives.  Recommending a DNS name means that the CP\r\n   would need to allow DNS from unauthenticated clients (as we don't\r\n   want to force users to use the CP's provided DNS) and some users\r\n   would use this to DNS Tunnel out.  This would make the CP admin block\r\n   external recursives).]\r\n\r\n4.  The Captive-Portal RA Option\r\n\r\n   [Ed: I'm far from an RA expert.  I think there are only 8 bits for\r\n   Type, is it worth burning an option code on this?  I have also\r\n   specified that the option length should padded to multiples of 8 byte\r\n\r\n\r\n\r\nKumari, et al.           Expires March 12, 2015                 [Page 5]\r\n\f\r\nInternet-Draft             DHCP Captive-Portal            September 2014\r\n\r\n\r\n   to better align with the examples I've seen.  Is this required /\r\n   preferred, or is smaller RAs better? ]\r\n\r\n   This section describes the Captive-Portal Router Advertisement\r\n   option.\r\n\r\n    0                   1                   2                   3\r\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\r\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\r\n      |     Type      |     Length    |              URI              .\r\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               .\r\n      .                                                               .\r\n      .                                                               .\r\n      .                                                               .\r\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\r\n               Figure 2: Captive-Portal RA Option Format\r\n\r\n   Type  TBA3\r\n\r\n   Length  8-bit unsigned integer.  The length of the option (including\r\n      the Type and Length fields) in units of 8 bytes.\r\n\r\n   URI  The URI (containing an IPv6 literal) of the authentication page\r\n      that the user should connect to.  This should be padded with NULL\r\n      (0x0) to make the total option length (including the Type and\r\n      Length fields) a multiple of 8 bytes.\r\n\r\n5.  Use of the Captive-Portal Option\r\n\r\n   [ED NOTE: This option provides notice to the OS / User applications\r\n   that there is a CP.  Because of differences in UI design between\r\n   Operating Systems, the exact behaviour by OS and Applications is left\r\n   to the OS vendor/Application Developer.]\r\n\r\n   The purpose of the Captive-Portal Option is to inform the operating\r\n   system and applications that they are behind a captive portal type\r\n   device and will need to authenticate before getting network access\r\n   (and how to reach the authentication page).  What is done with this\r\n   information is left up to the operating system and application\r\n   vendors.  This document provides a very high level example of what\r\n   could be done with this information.\r\n\r\n   Many operating systems / applications already include a \"connectivity\r\n   test\" to determine if they are behind a captive portal (for example,\r\n   attempting to fetch a specific URL and looking for a specific string\r\n   (such as \"Success\")).  These tests sometimes fail or take a long time\r\n   to determine when they are behind a CP, but are usually effective for\r\n   determining that the captive portal has been satisfied.  These tests\r\n\r\n\r\n\r\nKumari, et al.           Expires March 12, 2015                 [Page 6]\r\n\f\r\nInternet-Draft             DHCP Captive-Portal            September 2014\r\n\r\n\r\n   will continue to be needed, because there is currently no definitive\r\n   signal from the captive portal that it has been satisfied.  The\r\n   connectivity test may also need to be used if the captive portal\r\n   times out the user session and needs the user to re-authenticate /\r\n   pay again.  The operating system may still find the information about\r\n   the captive portal URI useful in this case.\r\n\r\n   When the device is informed that it is behind a captive portal it\r\n   SHOULD:\r\n\r\n   1.  Not initiate new IP connections until the CP has been satisfied\r\n       (other than those to the captive portal page and connectivity\r\n       checks).  Existing connections should be quiesced (this will\r\n       happen more often than some expect -- for example, the user\r\n       purchases 1 hour of Internet at a cafe and stays there for 3\r\n       hours -- this will \"interrupt\" the user a few times).\r\n\r\n   2.  Present a dialog box to the user informing them that they are\r\n       behind a captive portal and ask if they wish to proceed.\r\n\r\n   3.  If the user elects to proceed, the device should initiate a\r\n       connection to the captive portal login page using a web browser\r\n       configured with a separate cookie store, and without a proxy\r\n       server.  If there is a VPN in place, this connection should be\r\n       made outside of the VPN and the user should be informed that\r\n       connection is outside the VPN.  Some captive portals send the\r\n       user a cookie when they authenticate (so that the user can re-\r\n       authenticate more easily in the future) - the browser should keep\r\n       these CP cookies separate from other cookies.\r\n\r\n   4.  Once the user has authenticated, normal IP connectivity should\r\n       resume.  The CP success page should contain a string, e.g\r\n       \"CP_SATISFIED.\"  The OS can then use this string to provide\r\n       further information to the user.\r\n\r\n   5.  The device should (using an OS dependent method) expose to the\r\n       user / user applications that they have connected though a\r\n       captive portal (for example by creating a file in /proc/net/\r\n       containing the interface and captive portal URI).  This should\r\n       continue until the network changes, or a new DHCP message without\r\n       the CP is received.\r\n\r\n6.  IANA Considerations\r\n\r\n   This document defines DHCPv4 Captive-Portal option which requires\r\n   assignment of DHCPv4 option code TBA1 assigned from \"Bootp and DHCP\r\n   options\" registry (http://www.iana.org/assignments/ bootp-dhcp-\r\n   parameters/bootp-dhcp-parameters.xml), as specified in [RFC2939].\r\n\r\n\r\n\r\nKumari, et al.           Expires March 12, 2015                 [Page 7]\r\n\f\r\nInternet-Draft             DHCP Captive-Portal            September 2014\r\n\r\n\r\n   The IANA is also requested at assign an IPv6 RA Type code (TBA3) from\r\n   the [TODO] registry.  Thanks IANA!\r\n\r\n7.  Security Considerations\r\n\r\n   An attacker with the ability to inject DHCP messages could include\r\n   this option and so force users to contact an address of his choosing.\r\n   As an attacker with this capability could simply list himself as the\r\n   default gateway (and so intercept all the victim's traffic), this\r\n   does not provide them with significantly more capabilities.  Fake\r\n   DHCP servers / fake RAs are currently a security concern - this\r\n   doesn't make them any better or worse.\r\n\r\n   Devices and systems that automatically connect to an open network\r\n   could potentially be tracked using the techniques described in this\r\n   document (forcing the user to continually authenticate, or exposing\r\n   their browser fingerprint.)  However, similar tracking can already be\r\n   performed with the standard captive portal mechanisms, so this\r\n   technique does not give the attackers more capabilities.\r\n\r\n   By simplifying the interaction with the captive portal systems, and\r\n   doing away with the need for interception, we think that users will\r\n   be less likely to disable useful security safeguards like DNSSEC\r\n   validation, VPNs, etc.  In addition, because the system knows that it\r\n   is behind a captive portal, it can know not to send cookies,\r\n   credentials, etc.\r\n\r\n8.  Acknowledgements\r\n\r\n   The primary author has discussed this idea with a number of folk, and\r\n   asked them to assist by becoming co-authors.  Unfortunately he has\r\n   forgotten who many of them were; if you were one of them, I\r\n   apologize.\r\n\r\n   Thanks to Vint Cerf for the initial idea / asking me to write this.\r\n   Thanks to Wes George for supplying the IPv6 text.  Thanks to Lorenzo\r\n   and Erik for the V6 RA kick in the pants.\r\n\r\n   Thanks for Fred Baker for detailed review and comments.\r\n\r\n9.  Normative References\r\n\r\n   [RFC2119]  Bradner, S., \"Key words for use in RFCs to Indicate\r\n              Requirement Levels\", BCP 14, RFC 2119, March 1997.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nKumari, et al.           Expires March 12, 2015                 [Page 8]\r\n\f\r\nInternet-Draft             DHCP Captive-Portal            September 2014\r\n\r\n\r\nAppendix A.  Changes / Author Notes.\r\n\r\n   [RFC Editor: Please remove this section before publication ]\r\n\r\n   From 04 to 05:\r\n\r\n   o  Integrated comments, primarily from Fred Baker.\r\n\r\n   From 03 to 04:\r\n\r\n   o  Some text cleanup for readability.\r\n\r\n   o  Some disclaimers about it working better on initial connection\r\n      versus CP timeout.\r\n\r\n   o  Some more text explaining that CP interception is\r\n      indistinguishable from an attack.\r\n\r\n   o  Connectivity Check test.\r\n\r\n   o  Posting just before the draft cutoff - \"I love deadlines.  I love\r\n      the whooshing noise they make as they go by.\" -- Douglas Adams,\r\n      The Salmon of Doubt\r\n\r\n   From -02 to 03:\r\n\r\n   o  Removed the DHCPv6 stuff (as suggested / requested by Erik Kline)\r\n\r\n   o  Simplified / cleaned up text (I'm inclined to waffle on, then trim\r\n      the fluff)\r\n\r\n   o  This was written on a United flight with in-flight WiFi -\r\n      unfortunately I couldn't use it because their CP was borked. :-P\r\n\r\n   From -01 to 02:\r\n\r\n   o  Added the IPv6 RA stuff.\r\n\r\n   From -00 to -01:\r\n\r\n   o  Many nits and editorial changes.\r\n\r\n   o  Whole bunch of extra text and review from Wes George on v6.\r\n\r\n   From initial to -00.\r\n\r\n   o  Nothing changed in the template!\r\n\r\n\r\n\r\n\r\nKumari, et al.           Expires March 12, 2015                 [Page 9]\r\n\f\r\nInternet-Draft             DHCP Captive-Portal            September 2014\r\n\r\n\r\nAuthors' Addresses\r\n\r\n   Warren Kumari\r\n   Google\r\n   1600 Amphitheatre Parkway\r\n   Mountain View, CA  94043\r\n   US\r\n\r\n   Email: warren@kumari.net\r\n\r\n\r\n   Olafur Gudmundsson\r\n   Shinkuro Inc.\r\n   4922 Fairmont Av, Suite 250\r\n   Bethesda, MD  20814\r\n   USA\r\n\r\n   Email: ogud@ogud.com\r\n\r\n\r\n   Paul Ebersman\r\n   Comcast\r\n\r\n   Email: ebersman-ietf@dragon.net\r\n\r\n\r\n   Steve Sheng\r\n   Internet Corporation for Assigned Names and Numbers\r\n   12025 Waterfront Drive, Suite 300\r\n   Los Angeles  90094\r\n   United States of America\r\n\r\n   Phone: +1.310.301.5800\r\n   Email: steve.sheng@icann.org\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nKumari, et al.           Expires March 12, 2015                [Page 10]\r\n```","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}